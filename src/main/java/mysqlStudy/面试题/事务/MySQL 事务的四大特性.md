MySQL 事务具有标准的 ACID 特性，这是数据库事务可靠性的核心保证。
# 一、原子性 (Atomicity)
* 定义：事务是一个不可分割的工作单位，事务中的操作要么全部成功，要么全部失败回滚。
* MySQL 实现：
  * 通过 undo log (回滚日志)实现：
  * 在数据修改前，先将原始值记录到 undo log
  * 如果事务失败，根据 undo log 回滚到之前状态
    【？？】
* 示例：
```
START TRANSACTION;
UPDATE accounts SET balance = balance - 100 WHERE id = 1;
UPDATE accounts SET balance = balance + 100 WHERE id = 2;
-- 如果第二条语句失败，第一条也会自动回滚
COMMIT;
```
# 二、一致性 (Consistency)
* 定义：事务执行前后，数据库从一个一致状态转变为另一个一致状态。
* 实现保障：
通过其他三个特性 (AID) 共同保证
数据库内置约束：
主键/唯一约束
外键约束
字段类型/长度限制
* 示例：
```
-- 转账前后，系统总金额保持不变
-- 事务前：A(1000) + B(1000) = 2000
-- 事务后：A(900) + B(1100) = 2000
```

# 三、隔离性 (Isolation)
* 定义：多个并发事务执行时，一个事务的操作不应影响其他事务。
* MySQL 实现：
  * 通过 锁机制 和 MVCC (多版本并发控制)实现
    【锁机制的原理？？】
  * 四种隔离级别
* 示例问题：
```
-- 事务A读取数据后，事务B修改了该数据
-- 根据隔离级别决定事务A能否看到事务B的修改
```

# 四、持久性 (Durability)
* 定义：事务一旦提交，其结果就是永久性的，即使系统故障也不会丢失。
* MySQL 实现：
  * 通过 redo log (重做日志)实现：
    * 事务提交前先将修改写入 redo log
    * 系统崩溃恢复时重放 redo log
    【？？】
* 配置参数：
```
innodb_flush_log_at_trx_commit = 1  # 最严格持久化保证
```
# 五、ACID 特性关系图
原子性(A) + 隔离性(I) + 持久性(D) → 一致性(C)
# 六、MySQL 事务控制语句
* 显式事务：
```
START TRANSACTION;
-- SQL语句
COMMIT;  -- 或 ROLLBACK;
```
* 自动提交模式：
```
SET autocommit = 0;  -- 关闭自动提交
SET autocommit = 1;  -- 开启自动提交(默认)
```
【后面的内容完全没懂 后面学？？】
七、生产环境注意事项
长事务风险：

占用锁资源

undo log 膨胀

解决方案：拆分为小事务

锁优化：

尽量使用行锁而非表锁

减少锁定范围

性能权衡：

高一致性需求：选择严格隔离级别

高并发需求：适当降低隔离级别

八、InnoDB 事务实现架构
客户端请求
↓
事务管理器
↓
锁管理器 ←→ 存储引擎
↓
undo log ←→ redo log
↓
物理存储
